{% load url from future%}
{% load greta_tags %}

{% with current_ref=request.session.current_ref %}
  <ul class="nav nav-pills">
    <li {% if log %}class="active"{% endif %}>
      <a href="{% url 'repo_detail' pk=repo.pk ref=current_ref %}">
        Commit History
        <span class="badge badge-{% if current_ref|is_branch %}inverse{% else %}important{% endif %}">
          {{ current_ref|pretty_ref|truncatechars:10 }}
        </span>
      </a>
    </li>

    <li {% if files %}class="active"{% endif %}>
      <a href="#">
        Files
      </a>
    </li>

    {% if repo.branches %}
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
          Branches
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          {% for branch in repo.branches %}
            {% if current_ref == branch %}
              <li class="active">
            {% else %}
              <li>
            {% endif %}
            <a href="{% url 'repo_detail' pk=repo.pk ref=branch %}?ref={{ branch }}">
              {{ branch|pretty_ref }}
            </a>
              </li>
            {% endfor %}
        </ul>
      </li>
    {% else %}
      <li class="disabled"><a href="#">Branches</a></li>
    {% endif %}

    {% if repo.tags %}
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
          Tags
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          {% for tag in repo.tags %}
            {% if current_ref == tag %}
              <li class="active">
            {% else %}
              <li>
            {% endif %}
            <a href="{% url 'repo_detail' pk=repo.pk ref=tag %}?reftype=tag&ref={{ tag }}">
              {{ tag|pretty_ref }}
            </a>
              </li>
            {% endfor %}
        </ul>
      </li>
    {% else %}
      <li class="disabled"><a href="#">Tags</a></li>
    {% endif %}

  </ul>
{% endwith %}
